<!-- üåê BePeace Global Language Selector -->
<div id="google_translate_container" class="lang-inline">
  <span class="lang-label">üåê English ‚ñº</span>
  <div id="google_translate_element"></div>
</div>

<style>
  /* üåç Container placed below header */
  #google_translate_container {
    position: absolute;
    top: 100%;
    right: 30px;
    margin-top: 10px;
    z-index: 9999;
  }

  .lang-inline {
    position: relative;
    display: inline-block;
  }

  .lang-label {
    color: #ff4081;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    transition: color 0.4s ease, text-shadow 0.4s ease;
  }

  .lang-label:hover {
    color: #ff69b4;
    text-shadow: 0 0 6px rgba(255,105,180,0.5);
  }

  /* ‚ú® Glowing animation */
  .lang-label.glow {
    color: #ff91ae;
    text-shadow: 0 0 8px #ff91ae, 0 0 15px #ff69b4;
    animation: glowFade 1.4s ease-out;
  }

  @keyframes glowFade {
    0% { opacity: 1; text-shadow: 0 0 15px #ff91ae; }
    50% { opacity: 1; text-shadow: 0 0 25px #ff69b4; }
    100% { opacity: 1; text-shadow: none; }
  }

  /* Dropdown styling */
  #google_translate_element {
    display: none;
    position: absolute;
    top: 25px;
    right: 0;
    background: #fff;
    border: 1px solid #ffc6d6;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 6px 15px rgba(255, 145, 174, 0.4);
    transform: translateY(-10px);
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease-in-out;
  }

  /* Active (visible with fade + slide) */
  #google_translate_element.active {
    display: block;
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  /* Dropdown select box */
  #google_translate_element select.goog-te-combo {
    border-radius: 8px;
    padding: 7px 10px;
    border: 1px solid #ff91ae;
    background-color: #fff;
    color: #333;
    font-size: 13px;
    outline: none;
    cursor: pointer;
    transition: 0.3s ease;
  }

  #google_translate_element select.goog-te-combo:hover {
    border-color: #ff69b4;
    background-color: #fff0f6;
  }

  /* Hide Google Banner */
  .goog-te-banner-frame.skiptranslate { display: none !important; }
  body { top: 0px !important; }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const langLabel = document.querySelector(".lang-label");
  const langBox = document.getElementById("google_translate_element");

  // üåê Toggle dropdown open/close
  langLabel.addEventListener("click", (e) => {
    e.stopPropagation();
    langBox.classList.toggle("active");
  });

  // Close when clicking outside
  document.addEventListener("click", (e) => {
    if (!langBox.contains(e.target) && !langLabel.contains(e.target)) {
      langBox.classList.remove("active");
    }
  });

  // Load Google Translate script dynamically
  const script = document.createElement("script");
  script.src = "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
  document.body.appendChild(script);

  // Initialize Google Translate
  window.googleTranslateElementInit = function() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'af,sq,am,ar,hy,az,eu,be,bn,bg,ca,ceb,zh-CN,zh-TW,co,hr,cs,da,nl,en,eo,et,fi,fr,fy,gl,ka,de,el,gu,ht,ha,haw,he,hi,hmn,hu,is,ig,id,ga,it,ja,jw,kn,kk,km,ko,ku,ky,lo,la,lv,lt,lb,mg,ms,ml,mt,mi,mk,mn,my,ne,no,ny,or,ps,fa,pl,pt,pa,ro,ru,sm,gd,sr,st,si,sk,sl,so,es,su,sw,sv,tg,ta,te,th,tr,uk,ur,uz,vi,cy,xh,yi,yo,zu',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');

    detectCountryAndSetLanguage();
    watchForLanguageChange();
  };

  // üåé Detect location & auto-language
  async function detectCountryAndSetLanguage() {
    try {
      const res = await fetch("https://ipapi.co/json/");
      const data = await res.json();
      const country = data.country_code;
      const language = data.languages ? data.languages.split(",")[0].split("-")[0] : "en";
      console.log("Visitor:", country, "Lang:", language);

      if (country === "IN") return; // India = English

      const select = document.querySelector(".goog-te-combo");
      if (!select) return;

      const matchLang = Array.from(select.options).find(opt => opt.value.startsWith(language));
      if (matchLang && select.value !== matchLang.value) {
        select.value = matchLang.value;
        select.dispatchEvent(new Event("change"));
        updateLabel(matchLang.value);
      }
    } catch (err) {
      console.warn("üåê Language detection failed:", err);
    }
  }

  // Update language label on selection
  function watchForLanguageChange() {
    const observer = new MutationObserver(() => {
      const select = document.querySelector(".goog-te-combo");
      if (!select) return;
      select.addEventListener("change", () => {
        updateLabel(select.value);
        langBox.classList.remove("active");
      });
    });
    observer.observe(document.body, { childList: true, subtree: true });
  }

  function updateLabel(code) {
    const lang = code.split('-')[0];
    const name = new Intl.DisplayNames(['en'], { type: 'language' }).of(lang) || "English";
    const capitalized = name.charAt(0).toUpperCase() + name.slice(1);
    langLabel.textContent = `üåê ${capitalized} ‚ñº`;

    langLabel.classList.add("glow");
    setTimeout(() => langLabel.classList.remove("glow"), 1500);
  }
});
</script>