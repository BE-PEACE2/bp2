<!-- üåê BE PEACE Global Language Selector -->
<div id="google_translate_wrapper">
  <div class="lang-label loading">
    <span class="globe">üåé</span>
    <span class="lang-text">Loading‚Ä¶</span>
  </div>
  <div id="google_translate_element"></div>
</div>

<style>
  /* üåç Position top-right */
  #google_translate_wrapper {
    position: fixed;
    top: 12px;
    right: 30px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    font-family: system-ui, sans-serif;
  }

  /* üîπ Language button */
  .lang-label {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #ffc6d6;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: 600;
    color: #ff4081;
    box-shadow: 0 2px 8px rgba(255, 145, 174, 0.3);
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
  }

  .lang-label:hover {
    background: rgba(255, 240, 246, 0.95);
    transform: scale(1.05);
  }

  /* üåé Spinning globe animation */
  .globe {
    display: inline-block;
    animation: spin 1.3s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Stop spinning once ready */
  .lang-label.ready .globe {
    animation: none;
  }

  /* Dropdown */
  #google_translate_element {
    display: none;
    margin-top: 8px;
    background: #fff;
    border: 1px solid #ffc6d6;
    border-radius: 10px;
    padding: 8px;
    box-shadow: 0 4px 15px rgba(255, 145, 174, 0.4);
    transform: translateY(-10px);
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
  }

  #google_translate_element.active {
    display: block;
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  /* Dropdown select style */
  #google_translate_element select.goog-te-combo {
    border-radius: 8px;
    padding: 7px 10px;
    border: 1px solid #ff91ae;
    background-color: #fff;
    color: #333;
    font-size: 13px;
    outline: none;
    cursor: pointer;
    transition: 0.3s ease;
  }

  #google_translate_element select.goog-te-combo:hover {
    border-color: #ff69b4;
    background-color: #fff0f6;
  }

  /* Hide Google banner */
  .goog-te-banner-frame.skiptranslate { display: none !important; }
  body { top: 0px !important; }

  /* üå´Ô∏è Transparency effect on scroll */
  .lang-label.scrolled {
    opacity: 0.8;
    box-shadow: 0 1px 6px rgba(255, 145, 174, 0.2);
  }
</style>

<script>
(function () {
  const label = document.querySelector(".lang-label");
  const globe = label.querySelector(".globe");
  const langText = label.querySelector(".lang-text");
  const box = document.getElementById("google_translate_element");

  console.log("üïì Initializing translator loader...");

  // üîπ Step 1 ‚Äî Define callback globally before script loads
  window.googleTranslateElementInit = function () {
    console.log("‚öôÔ∏è Google callback fired ‚Äî initializing...");
    new google.translate.TranslateElement(
      {
        pageLanguage: "en",
        includedLanguages:
          "af,sq,am,ar,hy,az,eu,be,bn,bg,ca,ceb,zh-CN,zh-TW,co,hr,cs,da,nl,en,eo,et,fi,fr,fy,gl,ka,de,el,gu,ht,ha,haw,he,hi,hmn,hu,is,ig,id,ga,it,ja,jw,kn,kk,km,ko,ku,ky,lo,la,lv,lt,lb,mg,ms,ml,mt,mi,mk,mn,my,ne,no,ny,or,ps,fa,pl,pt,pa,ro,ru,sm,gd,sr,st,si,sk,sl,so,es,su,sw,sv,tg,ta,te,th,tr,uk,ur,uz,vi,cy,xh,yi,yo,zu",
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      },
      "google_translate_element"
    );

    // Wait until dropdown appears
    const interval = setInterval(() => {
      const select = document.querySelector(".goog-te-combo");
      if (select) {
        clearInterval(interval);
        console.log("‚úÖ Translator dropdown detected!");
        box.classList.add("ready");
        box.style.display = "block";
        label.classList.add("ready");
        globe.textContent = "üåê";
        langText.textContent = "English ‚ñº";
        detectAndSetLanguage();
        attachLanguageChange();
      }
    }, 500);
  };

  // üîπ Step 2 ‚Äî Load Google Translate script with guaranteed delay
  setTimeout(() => {
    console.log("üì• Loading Google Translate script...");
    const script = document.createElement("script");
    script.src =
      "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
    script.async = true;
    script.onerror = () => console.error("‚ùå Failed to load Google Translate script!");
    document.head.appendChild(script);
  }, 1000);

  // üåé Step 3 ‚Äî Auto-detect user country
  async function detectAndSetLanguage() {
    try {
      console.log("üåç Detecting user location...");
      const res = await fetch("https://ipapi.co/json/");
      const data = await res.json();
      const country = data.country_code;
      const lang = data.languages ? data.languages.split(",")[0].split("-")[0] : "en";
      console.log("üìç Detected:", country, "| Lang:", lang);

      const flag = country
        ? String.fromCodePoint(...[...country.toUpperCase()].map((c) => 127397 + c.charCodeAt()))
        : "üåê";

      const select = document.querySelector(".goog-te-combo");
      if (!select) return;

      if (country === "IN" || lang === "en") {
        console.log("üáÆüá≥ Defaulting to English for India");
        updateLabel(flag, "English");
        return;
      }

      const match = Array.from(select.options).find((o) => o.value.startsWith(lang));
      if (match) {
        console.log("‚úÖ Auto-selecting:", match.textContent);
        select.value = match.value;
        select.dispatchEvent(new Event("change"));
        updateLabel(flag, match.textContent);
      } else {
        updateLabel(flag, "English");
      }
    } catch (e) {
      console.error("üåê Language detection failed:", e);
      updateLabel("üåê", "English");
    }
  }

  // üîÅ Step 4 ‚Äî Watch manual language changes
  function attachLanguageChange() {
    const select = document.querySelector(".goog-te-combo");
    if (!select) return;
    select.addEventListener("change", () => {
      const flag = label.textContent.split(" ")[0] || "üåê";
      const name = select.options[select.selectedIndex].text;
      updateLabel(flag, name);
      box.classList.remove("active");
    });
  }

  // ‚ú® Step 5 ‚Äî Update label text
  function updateLabel(flag, name) {
    globe.textContent = flag;
    langText.textContent = `${name} ‚ñº`;
    label.classList.add("ready");
  }

  // üåê Toggle dropdown
  label.addEventListener("click", (e) => {
    e.stopPropagation();
    if (box.classList.contains("ready")) {
      box.classList.toggle("active");
    } else {
      console.warn("‚è≥ Still loading translator...");
    }
  });

  document.addEventListener("click", (e) => {
    if (!box.contains(e.target) && !label.contains(e.target)) {
      box.classList.remove("active");
    }
  });
})();
</script>