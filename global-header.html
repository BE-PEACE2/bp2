<!-- üåê BE PEACE Global Language Selector (Fixed and Polished) -->
<div id="google_translate_wrapper">
  <div class="lang-label">üåê English ‚ñº</div>
  <div id="google_translate_element"></div>
</div>

<style>
  /* üåç Position: right below the header bar */
  #google_translate_wrapper {
    position: absolute;
    top: 65px; /* Adjust if your header height differs */
    right: 30px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  /* üåê Button */
  .lang-label {
    color: #ff4081;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    background: #fff;
    border-radius: 6px;
    padding: 5px 10px;
    box-shadow: 0 2px 8px rgba(255, 145, 174, 0.3);
    transition: all 0.3s ease;
  }

  .lang-label:hover {
    color: #ff69b4;
    transform: scale(1.05);
  }

  /* Dropdown Box */
  #google_translate_element {
    display: none;
    margin-top: 8px;
    background: #fff;
    border: 1px solid #ffc6d6;
    border-radius: 10px;
    padding: 8px;
    box-shadow: 0 4px 15px rgba(255, 145, 174, 0.4);
    transform: translateY(-10px);
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
  }

  #google_translate_element.active {
    display: block;
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  /* Dropdown Select Style */
  #google_translate_element select.goog-te-combo {
    border-radius: 8px;
    padding: 7px 10px;
    border: 1px solid #ff91ae;
    background-color: #fff;
    color: #333;
    font-size: 13px;
    outline: none;
    cursor: pointer;
    transition: 0.3s ease;
  }

  #google_translate_element select.goog-te-combo:hover {
    border-color: #ff69b4;
    background-color: #fff0f6;
  }

  /* Hide Google Banner */
  .goog-te-banner-frame.skiptranslate { display: none !important; }
  body { top: 0px !important; }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const langLabel = document.querySelector(".lang-label");
  const langBox = document.getElementById("google_translate_element");

  // üåê Toggle open/close
  langLabel.addEventListener("click", (e) => {
    e.stopPropagation();
    if (langBox.classList.contains("active")) {
      langBox.classList.remove("active");
    } else if (document.querySelector(".goog-te-combo")) {
      langBox.classList.add("active");
    } else {
      langLabel.textContent = "üåê Loading‚Ä¶";
      setTimeout(() => {
        if (document.querySelector(".goog-te-combo")) langBox.classList.add("active");
        langLabel.textContent = "üåê English ‚ñº";
      }, 2000);
    }
  });

  // Close when clicking outside
  document.addEventListener("click", (e) => {
    if (!langBox.contains(e.target) && !langLabel.contains(e.target)) {
      langBox.classList.remove("active");
    }
  });

  // ‚úÖ Load Google Translate script dynamically
  const script = document.createElement("script");
  script.src = "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
  document.body.appendChild(script);

  // ‚úÖ Google Translate initialization
  window.googleTranslateElementInit = function() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'af,sq,am,ar,hy,az,eu,be,bn,bg,ca,ceb,zh-CN,zh-TW,co,hr,cs,da,nl,en,eo,et,fi,fr,fy,gl,ka,de,el,gu,ht,ha,haw,he,hi,hmn,hu,is,ig,id,ga,it,ja,jw,kn,kk,km,ko,ku,ky,lo,la,lv,lt,lb,mg,ms,ml,mt,mi,mk,mn,my,ne,no,ny,or,ps,fa,pl,pt,pa,ro,ru,sm,gd,sr,st,si,sk,sl,so,es,su,sw,sv,tg,ta,te,th,tr,uk,ur,uz,vi,cy,xh,yi,yo,zu',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');

    waitForTranslateDropdown();
  };

  // üïí Wait until the Google dropdown is ready
  function waitForTranslateDropdown() {
    const interval = setInterval(() => {
      const select = document.querySelector(".goog-te-combo");
      if (select) {
        clearInterval(interval);
        autoDetectVisitorLanguage();
        observeLanguageChange();
      }
    }, 800);
  }

  // üåç Detect visitor country & switch language automatically
  async function autoDetectVisitorLanguage() {
    try {
      const res = await fetch("https://ipapi.co/json/");
      const data = await res.json();
      const country = data.country_code;
      const lang = data.languages ? data.languages.split(",")[0].split("-")[0] : "en";
      console.log("üåé Detected Country:", country, "‚Üí Language:", lang);

      const select = document.querySelector(".goog-te-combo");
      if (!select) return;

      // üáÆüá≥ India ‚Üí Always English
      if (country === "IN" || lang === "en") {
        updateLabel("en");
        return;
      }

      // üåê For other countries ‚Üí Auto switch
      const match = Array.from(select.options).find(opt => opt.value.startsWith(lang));
      if (match) {
        select.value = match.value;
        select.dispatchEvent(new Event("change"));
        updateLabel(match.value);
      } else {
        updateLabel("en");
      }
    } catch (err) {
      console.warn("üåê Language detection failed:", err);
      updateLabel("en");
    }
  }

  // ü™Ñ Observe dropdown changes
  function observeLanguageChange() {
    const observer = new MutationObserver(() => {
      const select = document.querySelector(".goog-te-combo");
      if (!select) return;
      select.addEventListener("change", () => {
        updateLabel(select.value);
        langBox.classList.remove("active");
      });
    });
    observer.observe(document.body, { childList: true, subtree: true });
  }

  // ‚ú® Update label text
  function updateLabel(code) {
    const lang = code.split('-')[0];
    const name = new Intl.DisplayNames(['en'], { type: 'language' }).of(lang) || "English";
    const capitalized = name.charAt(0).toUpperCase() + name.slice(1);
    langLabel.textContent = `üåê ${capitalized} ‚ñº`;
  }
});
</script>